<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Система оценки компетенций</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ===== BASE STYLES ===== */
        :root {
            --primary-color: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary-color: #64748b;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --light-color: #f8fafc;
            --dark-color: #1e293b;
            --border-color: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --radius: 8px;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--dark-color);
            background-color: #f1f5f9;
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* ===== SIDEBAR ===== */
        .sidebar {
            width: 250px;
            background: var(--dark-color);
            color: white;
            padding: 1.5rem 0;
            transition: var(--transition);
        }

        .logo {
            padding: 0 1.5rem 1.5rem;
            border-bottom: 1px solid #334155;
            margin-bottom: 1.5rem;
        }

        .logo h2 {
            font-size: 1.5rem;
            color: white;
        }

        .user-info {
            padding: 0 1.5rem 1.5rem;
            border-bottom: 1px solid #334155;
            margin-bottom: 1.5rem;
        }

        .user-info h4 {
            font-size: 1.1rem;
            margin-bottom: 0.25rem;
        }

        .user-info .role-badge {
            display: inline-block;
            background: var(--primary-color);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-top: 0.5rem;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .nav-item:hover {
            background: #334155;
        }

        .nav-item.active {
            background: var(--primary-color);
            border-left: 4px solid #93c5fd;
        }

        .nav-item i {
            width: 20px;
            text-align: center;
        }

        /* ===== MAIN CONTENT ===== */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: white;
            padding: 1rem 2rem;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .notifications-btn {
            position: relative;
            background: none;
            border: none;
            font-size: 1.25rem;
            cursor: pointer;
            color: var(--secondary-color);
        }

        .notifications-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger-color);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logout-btn {
            background: var(--light-color);
            border: 1px solid var(--border-color);
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition);
        }

        .logout-btn:hover {
            background: #e2e8f0;
        }

        .content-area {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
        }

        /* ===== COMMON COMPONENTS ===== */
        .page-title {
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            color: var(--dark-color);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .card {
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .btn {
            padding: 0.5rem 1.25rem;
            border-radius: var(--radius);
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-secondary {
            background: var(--secondary-color);
            color: white;
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-warning {
            background: var(--warning-color);
            color: white;
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .btn-outline {
            background: white;
            border: 1px solid var(--border-color);
            color: var(--dark-color);
        }

        .btn-outline:hover {
            background: var(--light-color);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-sm {
            padding: 0.25rem 0.75rem;
            font-size: 0.875rem;
        }

        .search-box {
            position: relative;
            margin-bottom: 1.5rem;
        }

        .search-box input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 1rem;
        }

        .search-box i {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--secondary-color);
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background: var(--light-color);
            font-weight: 600;
        }

        tr:hover {
            background: #f8fafc;
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-primary {
            background: #dbeafe;
            color: var(--primary-color);
        }

        .badge-success {
            background: #d1fae5;
            color: var(--success-color);
        }

        .badge-warning {
            background: #fef3c7;
            color: var(--warning-color);
        }

        .rating-stars {
            display: flex;
            gap: 0.25rem;
        }

        .star {
            color: #e2e8f0;
            cursor: pointer;
            font-size: 1.25rem;
            transition: var(--transition);
        }

        .star.active {
            color: var(--warning-color);
        }

        .star:hover {
            color: #fbbf24;
        }

        .form-container {
            background: white;
            border-radius: var(--radius);
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
        }

        .form-title {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--primary-color);
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-control.error {
            border-color: var(--danger-color);
        }

        .form-control.success {
            border-color: var(--success-color);
        }

        .form-error {
            color: var(--danger-color);
            font-size: 0.875rem;
            margin-top: 0.25rem;
            display: none;
        }

        .form-error.show {
            display: block;
        }

        .form-hint {
            color: var(--secondary-color);
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }

        .select-control {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 1rem;
            background: white;
            cursor: pointer;
        }

        .select-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
        }

        .inline-form {
            background: #f8fafc;
            padding: 1.5rem;
            border-radius: var(--radius);
            margin-bottom: 1.5rem;
        }

        .inline-form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .inline-form-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        .edit-form {
            background: #f0f9ff;
            border: 2px solid #dbeafe;
            padding: 1.5rem;
            border-radius: var(--radius);
            margin: 1rem 0;
        }

        .edit-form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .edit-form-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .filter-container {
            background: var(--light-color);
            padding: 1rem;
            border-radius: var(--radius);
            margin-bottom: 1.5rem;
        }

        .filter-row {
            display: flex;
            gap: 1rem;
            align-items: flex-end;
            margin-bottom: 1rem;
        }

        .filter-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* ===== LOGIN PAGE ===== */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .login-card {
            background: white;
            border-radius: var(--radius);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 450px;
            padding: 2.5rem;
        }

        .login-title {
            text-align: center;
            margin-bottom: 2rem;
            color: var(--dark-color);
        }

        .login-error {
            background: #fee2e2;
            color: var(--danger-color);
            padding: 0.75rem;
            border-radius: var(--radius);
            margin-bottom: 1rem;
            display: none;
        }

        .login-error.show {
            display: block;
        }

        .password-toggle {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--secondary-color);
            cursor: pointer;
            font-size: 1rem;
        }

        .password-input-container {
            position: relative;
        }

        /* ===== SKILLS CATEGORIES ===== */
        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .category-card {
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .category-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-4px);
        }

        .category-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .category-icon {
            width: 50px;
            height: 50px;
            background: #dbeafe;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--primary-color);
        }

        .category-name {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .category-skills {
            color: var(--secondary-color);
            font-size: 0.9rem;
        }

        /* ===== SKILLS LIST ===== */
        .skills-list {
            list-style: none;
        }

        .skill-item {
            padding: 1rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .skill-item:hover {
            background: #f8fafc;
        }

        .skill-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .skill-name {
            font-weight: 500;
        }

        .skill-rating {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .skill-expand {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
            display: none;
        }

        .skill-expand.active {
            display: block;
        }

        .rating-options {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
        }

        .rating-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--border-color);
            background: white;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .rating-btn:hover {
            background: var(--light-color);
        }

        .rating-btn.selected {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* ===== PROFILE ===== */
        .profile-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 2rem;
        }

        .profile-info h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .profile-department {
            color: var(--secondary-color);
            font-size: 1.1rem;
        }

        .radar-container {
            height: 400px;
            margin-bottom: 2rem;
            position: relative;
        }

        .radar-chart {
            width: 100%;
            height: 100%;
        }

        .skills-summary {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
        }

        .summary-item {
            background: white;
            padding: 1rem;
            border-radius: var(--radius);
            border: 1px solid var(--border-color);
        }

        .summary-category {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }

        .summary-rating {
            font-size: 1.5rem;
            font-weight: 700;
        }

        /* ===== EMPLOYEES LIST ===== */
        .employees-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .employee-card {
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            position: relative;
        }

        .employee-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #dbeafe;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .employee-name {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .employee-position {
            color: var(--secondary-color);
            margin-bottom: 1rem;
        }

        .employee-skills {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .employee-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .compare-checkbox {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* ===== COMPARISON TABLE ===== */
        .comparison-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .comparison-table-container {
            overflow-x: auto;
        }

        .comparison-table {
            min-width: 800px;
        }

        .comparison-table th {
            position: sticky;
            left: 0;
            background: var(--light-color);
            z-index: 1;
        }

        .comparison-table td:first-child {
            position: sticky;
            left: 0;
            background: white;
            z-index: 1;
        }

        .highlight-difference {
            background: #fef3c7 !important;
        }

        /* ===== NOTIFICATIONS ===== */
        .notifications-list {
            list-style: none;
        }

        .notification-item {
            padding: 1rem;
            border-left: 4px solid transparent;
            border-bottom: 1px solid var(--border-color);
            transition: var(--transition);
        }

        .notification-item.unread {
            background: #f0f9ff;
            border-left-color: var(--primary-color);
        }

        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.5rem;
        }

        .notification-title {
            font-weight: 600;
        }

        .notification-time {
            color: var(--secondary-color);
            font-size: 0.875rem;
        }

        .notification-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }

        /* ===== ADMIN SKILLS MANAGEMENT ===== */
        .skills-management-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .category-with-skills {
            margin-bottom: 2rem;
            position: relative;
        }

        .category-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--primary-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .skills-in-category {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
        }

        .skill-card {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 1rem;
            position: relative;
        }

        .skill-card-actions {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            display: flex;
            gap: 0.5rem;
        }

        .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            padding: 0.25rem;
            border-radius: 4px;
        }

        .edit-btn {
            color: var(--warning-color);
        }

        .delete-btn {
            color: var(--danger-color);
        }

        .action-btn:hover {
            background: var(--light-color);
        }

        /* ===== CSV EXPORT ===== */
        .export-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .export-option {
            background: white;
            border: 2px solid var(--border-color);
            border-radius: var(--radius);
            padding: 1.5rem;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }

        .export-option:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }

        .export-option.selected {
            border-color: var(--primary-color);
            background: #f0f9ff;
        }

        .export-icon {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        /* ===== TOAST NOTIFICATIONS ===== */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            background: white;
            border-radius: var(--radius);
            padding: 1rem 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 1rem;
            min-width: 300px;
            animation: slideInRight 0.3s ease;
            border-left: 4px solid var(--primary-color);
        }

        .toast-success {
            border-left-color: var(--success-color);
        }

        .toast-warning {
            border-left-color: var(--warning-color);
        }

        .toast-danger {
            border-left-color: var(--danger-color);
        }

        .toast-icon {
            font-size: 1.5rem;
        }

        .toast-success .toast-icon {
            color: var(--success-color);
        }

        .toast-warning .toast-icon {
            color: var(--warning-color);
        }

        .toast-danger .toast-icon {
            color: var(--danger-color);
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .toast-message {
            color: var(--secondary-color);
            font-size: 0.875rem;
        }

        .toast-close {
            background: none;
            border: none;
            color: var(--secondary-color);
            cursor: pointer;
            font-size: 1.25rem;
        }

        /* ===== LOADING STATES ===== */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        .loading-text {
            color: var(--secondary-color);
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                padding: 1rem;
            }
            
            .nav-menu {
                display: flex;
                overflow-x: auto;
                gap: 0.5rem;
            }
            
            .nav-item {
                white-space: nowrap;
                padding: 0.5rem 1rem;
            }
            
            .content-area {
                padding: 1rem;
            }
            
            .filter-row {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .filter-row .form-group {
                width: 100%;
            }
            
            .categories-grid,
            .employees-grid {
                grid-template-columns: 1fr;
            }
            
            .skills-in-category {
                grid-template-columns: 1fr;
            }
            
            .skills-summary {
                grid-template-columns: 1fr;
            }
            
            .export-options {
                grid-template-columns: 1fr;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .form-actions .btn {
                width: 100%;
            }
        }

        /* ===== ANIMATIONS ===== */
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* ===== UTILITY CLASSES ===== */
        .d-none {
            display: none !important;
        }

        .d-flex {
            display: flex !important;
        }

        .text-center {
            text-align: center;
        }

        .text-muted {
            color: var(--secondary-color);
        }

        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .ml-auto { margin-left: auto; }
        .w-100 { width: 100%; }
        
        .fade-in {
            animation: fadeIn 0.3s ease;
        }
    </style>
</head>
<body>
    <!-- LOGIN PAGE -->
    <div id="login-page" class="login-container">
        <div class="login-card">
            <h1 class="login-title">Система оценки компетенций</h1>
            <div id="login-error" class="login-error"></div>
            <form id="login-form" novalidate>
                <div class="form-group">
                    <label class="form-label" for="username">Логин</label>
                    <input type="text" id="username" class="form-control" placeholder="Введите ваш логин" required>
                    <div class="form-error" id="username-error"></div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="password">Пароль</label>
                    <div class="password-input-container">
                        <input type="password" id="password" class="form-control" placeholder="Введите ваш пароль" required minlength="6">
                        <button type="button" class="password-toggle" id="password-toggle">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <div class="form-error" id="password-error"></div>
                    <div class="form-hint">Минимальная длина пароля: 6 символов</div>
                </div>
                <div class="form-group">
                    <div class="form-error" id="form-error"></div>
                </div>
                <button type="submit" class="btn btn-primary w-100" id="login-submit">
                    <span id="login-text">Войти</span>
                    <span id="login-loading" class="d-none">
                        <i class="fas fa-spinner fa-spin"></i> Вход...
                    </span>
                </button>
            </form>
        </div>
    </div>

    <!-- MAIN APPLICATION -->
    <div id="app" class="app-container d-none">
        <!-- SIDEBAR -->
        <aside class="sidebar">
            <div class="logo">
                <h2>SkillMatrix</h2>
            </div>
            <div class="user-info">
                <h4 id="current-user-name">Загрузка...</h4>
                <div id="current-user-role" class="role-badge">Загрузка...</div>
            </div>
            <ul class="nav-menu" id="nav-menu">
                <!-- Navigation items will be dynamically populated based on role -->
            </ul>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="main-content">
            <!-- HEADER -->
            <header class="header">
                <div id="page-title" class="page-title">
                    <i class="fas fa-home"></i>
                    <span>Главная</span>
                </div>
                <div class="header-actions">
                    <button class="notifications-btn" id="notifications-btn">
                        <i class="fas fa-bell"></i>
                        <span class="notifications-count" id="notifications-count">0</span>
                    </button>
                    <button class="logout-btn" id="logout-btn">
                        <i class="fas fa-sign-out-alt"></i>
                        Выйти
                    </button>
                </div>
            </header>

            <!-- CONTENT AREA (pages will be loaded here dynamically) -->
            <div class="content-area" id="content-area">
                <!-- Content will be dynamically loaded here -->
                <div class="card">
                    <h3>Добро пожаловать в систему оценки компетенций!</h3>
                    <p class="mt-2">Выберите раздел в меню слева для начала работы.</p>
                </div>
            </div>
        </main>
    </div>

    <!-- TOAST CONTAINER -->
    <div class="toast-container" id="toast-container"></div>

    <!-- TEMPLATES FOR DYNAMIC CONTENT -->
    <template id="category-card-template">
        <div class="category-card" data-category-id="">
            <div class="category-header">
                <div class="category-icon">
                    <i class="fas fa-code"></i>
                </div>
                <div>
                    <div class="category-name">Категория</div>
                    <div class="category-skills">10 навыков</div>
                </div>
            </div>
            <div class="category-description">
                Описание категории навыков
            </div>
        </div>
    </template>

    <template id="skill-item-template">
        <li class="skill-item" data-skill-id="">
            <div class="skill-header">
                <div class="skill-name">Название навыка</div>
                <div class="skill-rating">
                    <span class="current-rating">0</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
            </div>
            <div class="skill-expand">
                <div class="rating-options">
                    <button class="rating-btn" data-value="1">1</button>
                    <button class="rating-btn" data-value="2">2</button>
                    <button class="rating-btn" data-value="3">3</button>
                    <button class="rating-btn" data-value="4">4</button>
                    <button class="rating-btn" data-value="5">5</button>
                </div>
            </div>
        </li>
    </template>

    <template id="employee-card-template">
        <div class="employee-card" data-employee-id="">
            <div class="employee-avatar">
                <i class="fas fa-user"></i>
            </div>
            <h3 class="employee-name">Имя Фамилия</h3>
            <p class="employee-position">Должность</p>
            <div class="employee-skills">
                <span class="badge badge-primary">JavaScript</span>
                <span class="badge badge-primary">React</span>
            </div>
            <div class="employee-actions">
                <button class="btn btn-outline btn-sm view-profile-btn">Профиль</button>
                <div class="compare-checkbox">
                    <input type="checkbox" class="compare-checkbox-input">
                    <span>Сравнить</span>
                </div>
            </div>
        </div>
    </template>

    <!-- JavaScript -->
    <script>
        // ===== APPLICATION STATE =====
        let currentUser = null;
        let currentPage = 'home';
        let currentRole = null;
        let authToken = null;
        let categories = [];
        let skills = [];
        let employees = [];
        let userRatings = [];
        let notifications = [];

        // ===== API CONFIGURATION =====
        const API_BASE_URL = 'http://localhost:3000/api';
        const API_ENDPOINTS = {
            // Auth endpoints
            LOGIN: '/auth/login',
            LOGOUT: '/auth/logout',
            REFRESH_TOKEN: '/auth/refresh-token',
            
            // User endpoints
            USERS: '/users',
            USER_PROFILE: '/users/profile',
            USER_ROLES: '/users/roles',
            
            // Category endpoints
            CATEGORIES: '/categories',
            CATEGORY_BY_ID: (id) => `/categories/${id}`,
            
            // Skill endpoints
            SKILLS: '/skills',
            SKILL_BY_ID: (id) => `/skills/${id}`,
            SKILLS_BY_CATEGORY: (categoryId) => `/categories/${categoryId}/skills`,
            
            // Rating endpoints
            RATINGS: '/ratings',
            USER_RATINGS: '/ratings/user',
            SKILL_RATING: (skillId) => `/ratings/skill/${skillId}`,
            
            // Employee endpoints
            EMPLOYEES: '/employees',
            EMPLOYEE_BY_ID: (id) => `/employees/${id}`,
            EMPLOYEE_SKILLS: (id) => `/employees/${id}/skills`,
            
            // Notification endpoints
            NOTIFICATIONS: '/notifications',
            NOTIFICATIONS_UNREAD: '/notifications/unread',
            NOTIFICATIONS_MARK_READ: (id) => `/notifications/${id}/read`,
            
            // Report endpoints
            REPORTS: '/reports',
            REPORTS_DEPARTMENT: '/reports/department',
            REPORTS_EXPORT: '/reports/export',
            
            // Comparison endpoints
            COMPARE_EMPLOYEES: '/compare/employees'
        };

        // ===== ROLES CONFIGURATION =====
        const ROLES = {
            EMPLOYEE: 'employee',
            MANAGER: 'manager',
            ADMIN: 'admin'
        };

        const ROLE_CONFIG = {
            [ROLES.EMPLOYEE]: {
                name: 'Сотрудник',
                pages: [
                    { id: 'home', name: 'Главная', icon: 'fa-home' },
                    { id: 'skills', name: 'Каталог навыков', icon: 'fa-list' },
                    { id: 'profile', name: 'Мой профиль', icon: 'fa-user' },
                    { id: 'required-skills', name: 'Обязательные навыки', icon: 'fa-check-circle' },
                    { id: 'history', name: 'История изменений', icon: 'fa-history' },
                    { id: 'notifications', name: 'Уведомления', icon: 'fa-bell' }
                ]
            },
            [ROLES.MANAGER]: {
                name: 'Руководитель',
                pages: [
                    { id: 'home', name: 'Главная', icon: 'fa-home' },
                    { id: 'employees', name: 'Сотрудники отдела', icon: 'fa-users' },
                    { id: 'compare', name: 'Сравнение сотрудников', icon: 'fa-chart-bar' },
                    { id: 'notifications', name: 'Уведомления', icon: 'fa-bell' },
                    { id: 'reports', name: 'Отчеты', icon: 'fa-chart-pie' }
                ]
            },
            [ROLES.ADMIN]: {
                name: 'Администратор',
                pages: [
                    { id: 'home', name: 'Главная', icon: 'fa-home' },
                    { id: 'skills-management', name: 'Управление навыками', icon: 'fa-cogs' },
                    { id: 'users-management', name: 'Управление сотрудниками', icon: 'fa-user-cog' },
                    { id: 'reports', name: 'Отчеты', icon: 'fa-chart-pie' },
                    { id: 'export', name: 'Экспорт данных', icon: 'fa-file-export' },
                    { id: 'notifications', name: 'Уведомления', icon: 'fa-bell' }
                ]
            }
        };

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', function() {
            // Check for existing token
            const token = localStorage.getItem('auth_token');
            if (token) {
                authToken = token;
                loadUserProfile();
            }

            // Login form submission
            document.getElementById('login-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                await handleLogin();
            });

            // Password toggle
            document.getElementById('password-toggle').addEventListener('click', function() {
                const passwordInput = document.getElementById('password');
                const icon = this.querySelector('i');
                
                if (passwordInput.type === 'password') {
                    passwordInput.type = 'text';
                    icon.className = 'fas fa-eye-slash';
                } else {
                    passwordInput.type = 'password';
                    icon.className = 'fas fa-eye';
                }
            });

            // Form validation
            setupFormValidation();

            // Logout button
            document.getElementById('logout-btn').addEventListener('click', handleLogout);

            // Notifications button
            document.getElementById('notifications-btn').addEventListener('click', function() {
                navigateTo('notifications');
            });
        });

        // ===== FORM VALIDATION =====
        function setupFormValidation() {
            const loginForm = document.getElementById('login-form');
            
            // Real-time validation
            document.getElementById('username').addEventListener('input', function() {
                validateField(this, 'Логин обязателен для заполнения');
            });
            
            document.getElementById('password').addEventListener('input', function() {
                validateField(this, 'Пароль должен содержать минимум 6 символов');
            });
            
            // Form submit validation
            loginForm.addEventListener('submit', function(e) {
                let isValid = true;
                
                const username = document.getElementById('username');
                const password = document.getElementById('password');
                
                if (!validateField(username, 'Логин обязателен для заполнения')) {
                    isValid = false;
                }
                
                if (!validateField(password, 'Пароль должен содержать минимум 6 символов')) {
                    isValid = false;
                }
                
                if (!isValid) {
                    e.preventDefault();
                }
            });
        }

        function validateField(field, errorMessage) {
            const errorElement = document.getElementById(`${field.id}-error`);
            
            // Clear previous error
            field.classList.remove('error');
            field.classList.remove('success');
            errorElement.classList.remove('show');
            errorElement.textContent = '';
            
            // Check if field is valid
            let isValid = true;
            
            if (field.required && !field.value.trim()) {
                isValid = false;
            } else if (field.type === 'password' && field.value.length < 6) {
                isValid = false;
            } else if (field.type === 'email' && !isValidEmail(field.value)) {
                isValid = false;
                errorMessage = 'Введите корректный email адрес';
            }
            
            // Update UI
            if (!isValid) {
                field.classList.add('error');
                errorElement.textContent = errorMessage;
                errorElement.classList.add('show');
            } else {
                field.classList.add('success');
            }
            
            return isValid;
        }

        function isValidEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        // ===== API SERVICE =====
        async function apiRequest(endpoint, options = {}) {
            const url = API_BASE_URL + endpoint;
            
            const defaultOptions = {
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': authToken ? `Bearer ${authToken}` : ''
                },
                credentials: 'include'
            };
            
            const config = {
                ...defaultOptions,
                ...options,
                headers: {
                    ...defaultOptions.headers,
                    ...options.headers
                }
            };
            
            try {
                const response = await fetch(url, config);
                
                // Handle 401 Unauthorized - token expired
                if (response.status === 401 && authToken) {
                    const refreshed = await refreshToken();
                    if (refreshed) {
                        // Retry the request with new token
                        config.headers.Authorization = `Bearer ${authToken}`;
                        return await fetch(url, config);
                    } else {
                        handleLogout();
                        throw new Error('Сессия истекла. Пожалуйста, войдите снова.');
                    }
                }
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.message || `HTTP error ${response.status}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error('API request failed:', error);
                throw error;
            }
        }

        async function refreshToken() {
            try {
                const response = await fetch(API_BASE_URL + API_ENDPOINTS.REFRESH_TOKEN, {
                    method: 'POST',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    authToken = data.token;
                    localStorage.setItem('auth_token', authToken);
                    return true;
                }
            } catch (error) {
                console.error('Token refresh failed:', error);
            }
            
            return false;
        }

        // ===== AUTHENTICATION =====
        async function handleLogin() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            
            // Show loading state
            const submitBtn = document.getElementById('login-submit');
            const loginText = document.getElementById('login-text');
            const loginLoading = document.getElementById('login-loading');
            
            loginText.classList.add('d-none');
            loginLoading.classList.remove('d-none');
            submitBtn.disabled = true;
            
            // Clear previous errors
            document.getElementById('form-error').textContent = '';
            
            try {
                const response = await fetch(API_BASE_URL + API_ENDPOINTS.LOGIN, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.message || 'Ошибка входа');
                }
                
                // Save token and user data
                authToken = data.token;
                currentUser = data.user;
                currentRole = data.user.role;
                
                localStorage.setItem('auth_token', authToken);
                localStorage.setItem('user', JSON.stringify(data.user));
                
                // Update UI
                document.getElementById('login-page').classList.add('d-none');
                document.getElementById('app').classList.remove('d-none');
                
                updateUserInfo();
                updateNavigation();
                navigateTo('home');
                
                // Load initial data
                await loadInitialData();
                
                showToast('Вход выполнен успешно!', 'success');
                
            } catch (error) {
                console.error('Login failed:', error);
                
                // Show error message
                const formError = document.getElementById('form-error');
                formError.textContent = error.message || 'Неверный логин или пароль';
                formError.classList.add('show');
                
                showToast(error.message || 'Ошибка входа', 'danger');
                
            } finally {
                // Reset loading state
                loginText.classList.remove('d-none');
                loginLoading.classList.add('d-none');
                submitBtn.disabled = false;
            }
        }

        async function loadUserProfile() {
            try {
                const data = await apiRequest(API_ENDPOINTS.USER_PROFILE);
                currentUser = data.user;
                currentRole = data.user.role;
                
                document.getElementById('login-page').classList.add('d-none');
                document.getElementById('app').classList.remove('d-none');
                
                updateUserInfo();
                updateNavigation();
                navigateTo('home');
                
                // Load initial data
                await loadInitialData();
                
            } catch (error) {
                console.error('Failed to load user profile:', error);
                localStorage.removeItem('auth_token');
                localStorage.removeItem('user');
                authToken = null;
                currentUser = null;
            }
        }

        async function handleLogout() {
            try {
                await apiRequest(API_ENDPOINTS.LOGOUT, {
                    method: 'POST'
                });
            } catch (error) {
                console.error('Logout error:', error);
            } finally {
                // Clear local storage
                localStorage.removeItem('auth_token');
                localStorage.removeItem('user');
                
                // Reset state
                authToken = null;
                currentUser = null;
                currentRole = null;
                
                // Update UI
                document.getElementById('app').classList.add('d-none');
                document.getElementById('login-page').classList.remove('d-none');
                
                // Reset login form
                document.getElementById('login-form').reset();
                document.getElementById('form-error').textContent = '';
                
                showToast('Вы успешно вышли из системы', 'success');
            }
        }

        // ===== INITIAL DATA LOADING =====
        async function loadInitialData() {
            try {
                // Load categories and skills
                categories = await apiRequest(API_ENDPOINTS.CATEGORIES);
                skills = await apiRequest(API_ENDPOINTS.SKILLS);
                
                // Load user ratings
                userRatings = await apiRequest(API_ENDPOINTS.USER_RATINGS);
                
                // Load notifications
                notifications = await apiRequest(API_ENDPOINTS.NOTIFICATIONS_UNREAD);
                updateNotificationsCount();
                
                // Load employees for managers and admins
                if (currentRole === ROLES.MANAGER || currentRole === ROLES.ADMIN) {
                    employees = await apiRequest(API_ENDPOINTS.EMPLOYEES);
                }
                
            } catch (error) {
                console.error('Failed to load initial data:', error);
                showToast('Ошибка загрузки данных', 'danger');
            }
        }

        // ===== NAVIGATION =====
        function updateNavigation() {
            const navMenu = document.getElementById('nav-menu');
            navMenu.innerHTML = '';
            
            const rolePages = ROLE_CONFIG[currentRole].pages;
            
            rolePages.forEach(page => {
                const li = document.createElement('li');
                li.className = `nav-item ${currentPage === page.id ? 'active' : ''}`;
                li.dataset.page = page.id;
                li.innerHTML = `
                    <i class="fas ${page.icon}"></i>
                    <span>${page.name}</span>
                `;
                li.addEventListener('click', () => navigateTo(page.id));
                navMenu.appendChild(li);
            });
        }

        function updateUserInfo() {
            if (currentUser) {
                document.getElementById('current-user-name').textContent = 
                    `${currentUser.firstName} ${currentUser.lastName}`;
                document.getElementById('current-user-role').textContent = ROLE_CONFIG[currentRole].name;
            }
        }

        function navigateTo(pageId) {
            currentPage = pageId;
            updateNavigation();
            updatePageTitle(pageId);
            loadPageContent(pageId);
        }

        function updatePageTitle(pageId) {
            const pageTitle = document.getElementById('page-title');
            const rolePages = ROLE_CONFIG[currentRole].pages;
            const page = rolePages.find(p => p.id === pageId);
            
            if (page) {
                pageTitle.innerHTML = `
                    <i class="fas ${page.icon}"></i>
                    <span>${page.name}</span>
                `;
            }
        }

        // ===== PAGE CONTENT LOADING =====
        function loadPageContent(pageId) {
            const contentArea = document.getElementById('content-area');
            
            // Show loading state
            contentArea.innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">Загрузка...</div>
                </div>
            `;
            
            setTimeout(() => {
                switch(pageId) {
                    case 'home':
                        loadHomePage(contentArea);
                        break;
                    case 'skills':
                        loadSkillsPage(contentArea);
                        break;
                    case 'profile':
                        loadProfilePage(contentArea);
                        break;
                    case 'required-skills':
                        loadRequiredSkillsPage(contentArea);
                        break;
                    case 'history':
                        loadHistoryPage(contentArea);
                        break;
                    case 'employees':
                        loadEmployeesPage(contentArea);
                        break;
                    case 'compare':
                        loadComparePage(contentArea);
                        break;
                    case 'skills-management':
                        loadSkillsManagementPage(contentArea);
                        break;
                    case 'users-management':
                        loadUsersManagementPage(contentArea);
                        break;
                    case 'reports':
                        loadReportsPage(contentArea);
                        break;
                    case 'export':
                        loadExportPage(contentArea);
                        break;
                    case 'notifications':
                        loadNotificationsPage(contentArea);
                        break;
                    default:
                        contentArea.innerHTML = '<div class="card"><h3>Страница в разработке</h3></div>';
                }
            }, 100);
        }

        // ===== PAGE TEMPLATES =====
        function loadHomePage(container) {
            container.innerHTML = `
                <div class="card">
                    <h3>Добро пожаловать, ${currentUser.firstName}!</h3>
                    <p class="mt-2">Вы вошли как ${ROLE_CONFIG[currentRole].name}.</p>
                    
                    ${currentRole === ROLES.EMPLOYEE ? `
                    <div class="mt-3">
                        <h4>Ваши задачи:</h4>
                        <ul class="mt-1">
                            <li>Оцените обязательные навыки для вашего отдела</li>
                            <li>Обновите самооценку по актуальным навыкам</li>
                            <li>Просмотрите ваш профиль компетенций</li>
                        </ul>
                    </div>
                    ` : ''}
                    
                    ${currentRole === ROLES.MANAGER ? `
                    <div class="mt-3">
                        <h4>Задачи руководителя:</h4>
                        <ul class="mt-1">
                            <li>Просмотр профилей сотрудников вашего отдела</li>
                            <li>Подтверждение или корректировка оценок сотрудников</li>
                            <li>Сравнение навыков нескольких сотрудников</li>
                            <li>Поиск сотрудников по навыкам</li>
                        </ul>
                    </div>
                    ` : ''}
                    
                    ${currentRole === ROLES.ADMIN ? `
                    <div class="mt-3">
                        <h4>Задачи администратора:</h4>
                        <ul class="mt-1">
                            <li>Управление справочником навыков и категорий</li>
                            <li>Создание и управление учетными записями сотрудников</li>
                            <li>Просмотр сводных отчетов по отделам</li>
                            <li>Экспорт данных в CSV</li>
                        </ul>
                    </div>
                    ` : ''}
                </div>
                
                ${currentRole === ROLES.EMPLOYEE ? `
                <div class="card mt-3">
                    <div class="card-header">
                        <h3 class="card-title">Быстрый доступ</h3>
                    </div>
                    <div class="skills-summary">
                        <div class="summary-item">
                            <div class="summary-category">Обязательные навыки</div>
                            <div class="summary-rating" id="required-skills-count">0/0</div>
                            <div class="text-muted">Требуют оценки</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-category">Последняя оценка</div>
                            <div class="summary-rating" id="last-rating-time">-</div>
                            <div class="text-muted">Время последнего обновления</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-category">Новые уведомления</div>
                            <div class="summary-rating" id="home-notifications-count">${notifications.length}</div>
                            <div class="text-muted">Требуют внимания</div>
                        </div>
                    </div>
                </div>
                ` : ''}
            `;
            
            // Load additional data for employee
            if (currentRole === ROLES.EMPLOYEE) {
                loadEmployeeHomeData();
            }
        }

        async function loadEmployeeHomeData() {
            try {
                // Get required skills count
                const requiredSkills = skills.filter(skill => skill.isRequired);
                const ratedSkills = userRatings.filter(rating => rating.rating > 0);
                
                document.getElementById('required-skills-count').textContent = 
                    `${ratedSkills.length}/${requiredSkills.length}`;
                
                // Get last rating time
                if (userRatings.length > 0) {
                    const lastRating = userRatings.sort((a, b) => 
                        new Date(b.updatedAt) - new Date(a.updatedAt)
                    )[0];
                    
                    const lastDate = new Date(lastRating.updatedAt);
                    const now = new Date();
                    const diffHours = Math.floor((now - lastDate) / (1000 * 60 * 60));
                    
                    if (diffHours < 24) {
                        document.getElementById('last-rating-time').textContent = 
                            `${diffHours} ч. назад`;
                    } else {
                        const diffDays = Math.floor(diffHours / 24);
                        document.getElementById('last-rating-time').textContent = 
                            `${diffDays} дн. назад`;
                    }
                }
                
            } catch (error) {
                console.error('Failed to load employee home data:', error);
            }
        }

        function loadSkillsPage(container) {
            container.innerHTML = `
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Каталог навыков</h3>
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="skills-search" placeholder="Поиск навыка...">
                        </div>
                    </div>
                    <div class="categories-grid" id="categories-container"></div>
                </div>
            `;
            
            renderCategories();
            
            // Add search functionality
            document.getElementById('skills-search').addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                filterCategories(searchTerm);
            });
        }

        function renderCategories() {
            const container = document.getElementById('categories-container');
            container.innerHTML = '';
            
            if (categories.length === 0) {
                container.innerHTML = '<p class="text-center text-muted">Категории не найдены</p>';
                return;
            }
            
            categories.forEach(category => {
                const categorySkills = skills.filter(skill => skill.categoryId === category.id);
                
                const template = document.getElementById('category-card-template');
                const card = template.content.cloneNode(true);
                
                const categoryCard = card.querySelector('.category-card');
                categoryCard.dataset.categoryId = category.id;
                categoryCard.querySelector('.category-icon i').className = `fas ${category.icon || 'fa-folder'}`;
                categoryCard.querySelector('.category-name').textContent = category.name;
                categoryCard.querySelector('.category-skills').textContent = `${categorySkills.length} навыков`;
                categoryCard.querySelector('.category-description').textContent = category.description || 'Описание отсутствует';
                
                categoryCard.addEventListener('click', function() {
                    loadCategorySkills(category.id, category.name);
                });
                
                container.appendChild(card);
            });
        }

        function filterCategories(searchTerm) {
            const categoryCards = document.querySelectorAll('.category-card');
            
            categoryCards.forEach(card => {
                const name = card.querySelector('.category-name').textContent.toLowerCase();
                const description = card.querySelector('.category-description').textContent.toLowerCase();
                
                if (name.includes(searchTerm) || description.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        async function loadCategorySkills(categoryId, categoryName) {
            const contentArea = document.getElementById('content-area');
            
            try {
                // Load skills for this category from API
                const categorySkills = await apiRequest(API_ENDPOINTS.SKILLS_BY_CATEGORY(categoryId));
                
                contentArea.innerHTML = `
                    <div class="card">
                        <div class="card-header">
                            <div>
                                <h3 class="card-title">${categoryName}</h3>
                                <p class="text-muted mt-1">${categorySkills.length} навыков</p>
                            </div>
                            <button class="btn btn-outline" id="back-to-categories">
                                <i class="fas fa-arrow-left"></i> Назад к категориям
                            </button>
                        </div>
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="category-skills-search" placeholder="Поиск навыка в категории...">
                        </div>
                        <ul class="skills-list" id="skills-list"></ul>
                    </div>
                `;
                
                // Render skills
                const skillsList = document.getElementById('skills-list');
                
                if (categorySkills.length === 0) {
                    skillsList.innerHTML = '<p class="text-center text-muted">Навыки не найдены</p>';
                } else {
                    categorySkills.forEach(skill => {
                        const userRating = userRatings.find(r => r.skillId === skill.id);
                        const currentRating = userRating ? userRating.rating : 0;
                        
                        const template = document.getElementById('skill-item-template');
                        const item = template.content.cloneNode(true);
                        
                        const skillItem = item.querySelector('.skill-item');
                        skillItem.dataset.skillId = skill.id;
                        skillItem.querySelector('.skill-name').textContent = skill.name;
                        skillItem.querySelector('.current-rating').textContent = currentRating;
                        
                        // Mark selected rating button
                        if (currentRating > 0) {
                            const ratingBtn = skillItem.querySelector(`.rating-btn[data-value="${currentRating}"]`);
                            if (ratingBtn) {
                                ratingBtn.classList.add('selected');
                            }
                        }
                        
                        // Add click handler for expanding rating options
                        skillItem.addEventListener('click', function(e) {
                            if (!e.target.classList.contains('rating-btn')) {
                                const expand = this.querySelector('.skill-expand');
                                expand.classList.toggle('active');
                            }
                        });
                        
                        // Add rating button handlers
                        const ratingBtns = item.querySelectorAll('.rating-btn');
                        ratingBtns.forEach(btn => {
                            btn.addEventListener('click', async function(e) {
                                e.stopPropagation();
                                const skillId = this.closest('.skill-item').dataset.skillId;
                                const rating = parseInt(this.dataset.value);
                                
                                try {
                                    await setSkillRating(skillId, rating);
                                    
                                    // Update current rating display
                                    this.closest('.skill-item').querySelector('.current-rating').textContent = rating;
                                    
                                    // Mark selected button
                                    this.closest('.skill-expand').querySelectorAll('.rating-btn').forEach(b => {
                                        b.classList.remove('selected');
                                    });
                                    this.classList.add('selected');
                                    
                                    showToast('Оценка сохранена успешно!', 'success');
                                    
                                } catch (error) {
                                    showToast('Ошибка сохранения оценки', 'danger');
                                }
                            });
                        });
                        
                        skillsList.appendChild(item);
                    });
                }
                
                // Back button
                document.getElementById('back-to-categories').addEventListener('click', function() {
                    loadSkillsPage(contentArea);
                });
                
                // Search functionality
                document.getElementById('category-skills-search').addEventListener('input', function(e) {
                    const searchTerm = e.target.value.toLowerCase();
                    filterSkillsInCategory(searchTerm);
                });
                
            } catch (error) {
                console.error('Failed to load category skills:', error);
                contentArea.innerHTML = `
                    <div class="card">
                        <h3>Ошибка загрузки навыков</h3>
                        <p class="mt-2">${error.message}</p>
                        <button class="btn btn-outline mt-2" onclick="loadSkillsPage(this.closest('.content-area'))">
                            <i class="fas fa-arrow-left"></i> Назад к категориям
                        </button>
                    </div>
                `;
            }
        }

        function filterSkillsInCategory(searchTerm) {
            const skillItems = document.querySelectorAll('#skills-list .skill-item');
            
            skillItems.forEach(skill => {
                const name = skill.querySelector('.skill-name').textContent.toLowerCase();
                
                if (name.includes(searchTerm)) {
                    skill.style.display = 'flex';
                } else {
                    skill.style.display = 'none';
                }
            });
        }

        async function setSkillRating(skillId, rating) {
            try {
                const response = await apiRequest(API_ENDPOINTS.RATINGS, {
                    method: 'POST',
                    body: JSON.stringify({
                        skillId: parseInt(skillId),
                        rating: rating
                    })
                });
                
                // Update local ratings
                const existingIndex = userRatings.findIndex(r => r.skillId === parseInt(skillId));
                if (existingIndex >= 0) {
                    userRatings[existingIndex] = response.rating;
                } else {
                    userRatings.push(response.rating);
                }
                
                return response;
                
            } catch (error) {
                console.error('Failed to set skill rating:', error);
                throw error;
            }
        }

        async function loadProfilePage(container) {
            try {
                // Load detailed profile data
                const profileData = await apiRequest('/users/profile/details');
                
                container.innerHTML = `
                    <div class="card">
                        <div class="profile-header">
                            <div class="profile-info">
                                <h3>Профиль компетенций</h3>
                                <p class="profile-department">Отдел: ${profileData.department || 'Не указан'}</p>
                                <p class="text-muted">Должность: ${profileData.position || 'Не указана'}</p>
                            </div>
                            <button class="btn btn-primary" id="update-ratings-btn">
                                <i class="fas fa-edit"></i> Обновить оценки
                            </button>
                        </div>
                        
                        <div class="radar-container">
                            <div class="text-center">
                                <h4>Радарная диаграмма компетенций</h4>
                                <p class="text-muted mt-1">(Здесь будет диаграмма при наличии данных)</p>
                                <div style="height: 300px; background: #f8fafc; border-radius: var(--radius); 
                                           display: flex; align-items: center; justify-content: center; margin-top: 1rem;">
                                    <i class="fas fa-chart-radar" style="font-size: 3rem; color: var(--primary-color);"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="skills-summary mt-3">
                            ${profileData.categoryStats ? profileData.categoryStats.map(stat => `
                                <div class="summary-item">
                                    <div class="summary-category">${stat.categoryName}</div>
                                    <div class="summary-rating">${stat.averageRating.toFixed(1)}</div>
                                    <div class="text-muted">Средняя оценка (${stat.skillCount} навыков)</div>
                                </div>
                            `).join('') : '<p class="text-muted">Нет данных о навыках</p>'}
                        </div>
                        
                        <div class="mt-3">
                            <h4>Подробный список навыков</h4>
                            <div class="table-container mt-2">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Навык</th>
                                            <th>Категория</th>
                                            <th>Ваша оценка</th>
                                            <th>Статус</th>
                                            <th>Действия</th>
                                        </tr>
                                    </thead>
                                    <tbody id="profile-skills-table">
                                        <!-- Skills will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="mt-3 text-center">
                            <button class="btn btn-outline" id="view-history-btn">
                                <i class="fas fa-history"></i> Просмотреть историю изменений
                            </button>
                        </div>
                    </div>
                `;
                
                // Populate skills table
                populateProfileSkillsTable(profileData.skills || []);
                
                // Add event listeners
                document.getElementById('update-ratings-btn').addEventListener('click', function() {
                    navigateTo('skills');
                });
                
                document.getElementById('view-history-btn').addEventListener('click', function() {
                    navigateTo('history');
                });
                
            } catch (error) {
                console.error('Failed to load profile:', error);
                container.innerHTML = `
                    <div class="card">
                        <h3>Ошибка загрузки профиля</h3>
                        <p class="mt-2">${error.message}</p>
                        <button class="btn btn-outline mt-2" onclick="loadPageContent('home')">
                            <i class="fas fa-home"></i> На главную
                        </button>
                    </div>
                `;
            }
        }

        function populateProfileSkillsTable(skills) {
            const tbody = document.getElementById('profile-skills-table');
            tbody.innerHTML = '';
            
            if (skills.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="text-center text-muted">Нет оцененных навыков</td>
                    </tr>
                `;
                return;
            }
            
            skills.forEach(skill => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${skill.name}</td>
                    <td>${skill.categoryName}</td>
                    <td>
                        <div class="rating-stars">
                            ${generateStars(5, skill.rating)}
                        </div>
                    </td>
                    <td>
                        ${skill.confirmed ? 
                            '<span class="badge badge-success">Подтверждено</span>' : 
                            '<span class="badge badge-warning">Ожидает подтверждения</span>'
                        }
                    </td>
                    <td>
                        <button class="btn btn-sm btn-outline edit-rating-btn" data-skill-id="${skill.id}">
                            <i class="fas fa-edit"></i> Изменить
                        </button>
                    </td>
                `;
                
                // Add event listener for edit button
                row.querySelector('.edit-rating-btn').addEventListener('click', function() {
                    const skillId = this.dataset.skillId;
                    navigateTo('skills');
                    // In a real app, you would scroll to or highlight the specific skill
                });
                
                tbody.appendChild(row);
            });
        }

        function generateStars(total, filled) {
            let stars = '';
            for (let i = 1; i <= total; i++) {
                stars += `<i class="fas fa-star star ${i <= filled ? 'active' : ''}"></i>`;
            }
            return stars;
        }

        // ===== ADMIN PAGES =====
        function loadSkillsManagementPage(container) {
            container.innerHTML = `
                <div class="card">
                    <div class="skills-management-header">
                        <h3 class="card-title">Управление навыками и категориями</h3>
                    </div>
                    
                    <!-- Add Category Form -->
                    <div class="form-container" id="add-category-form-container">
                        <h4 class="form-title">Добавить новую категорию</h4>
                        <form id="add-category-form">
                            <div class="form-group">
                                <label class="form-label" for="category-name">Название категории *</label>
                                <input type="text" id="category-name" class="form-control" 
                                       placeholder="Введите название категории" required>
                                <div class="form-error" id="category-name-error"></div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="category-description">Описание</label>
                                <textarea id="category-description" class="form-control" 
                                          rows="3" placeholder="Введите описание категории"></textarea>
                                <div class="form-error" id="category-description-error"></div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="category-icon">Иконка</label>
                                <select id="category-icon" class="select-control">
                                    <option value="fa-code">Code (fa-code)</option>
                                    <option value="fa-database">Database (fa-database)</option>
                                    <option value="fa-tools">Tools (fa-tools)</option>
                                    <option value="fa-chart-line">Chart (fa-chart-line)</option>
                                    <option value="fa-comments">Comments (fa-comments)</option>
                                    <option value="fa-users">Users (fa-users)</option>
                                    <option value="fa-cogs">Cogs (fa-cogs)</option>
                                    <option value="fa-laptop-code">Laptop (fa-laptop-code)</option>
                                </select>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-outline" id="cancel-add-category">
                                    Отмена
                                </button>
                                <button type="submit" class="btn btn-primary" id="submit-add-category">
                                    <span id="add-category-text">Добавить категорию</span>
                                    <span id="add-category-loading" class="d-none">
                                        <i class="fas fa-spinner fa-spin"></i> Сохранение...
                                    </span>
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Add Skill Form -->
                    <div class="form-container mt-3" id="add-skill-form-container">
                        <h4 class="form-title">Добавить новый навык</h4>
                        <form id="add-skill-form">
                            <div class="form-group">
                                <label class="form-label" for="skill-name">Название навыка *</label>
                                <input type="text" id="skill-name" class="form-control" 
                                       placeholder="Введите название навыка" required>
                                <div class="form-error" id="skill-name-error"></div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="skill-description">Описание</label>
                                <textarea id="skill-description" class="form-control" 
                                          rows="3" placeholder="Введите описание навыка"></textarea>
                                <div class="form-error" id="skill-description-error"></div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="skill-category">Категория *</label>
                                <select id="skill-category" class="select-control" required>
                                    <option value="">Выберите категорию</option>
                                    ${categories.map(cat => 
                                        `<option value="${cat.id}">${cat.name}</option>`
                                    ).join('')}
                                </select>
                                <div class="form-error" id="skill-category-error"></div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <input type="checkbox" id="skill-required"> Обязательный навык
                                </label>
                                <div class="form-hint">Обязательные навыки должны быть оценены всеми сотрудниками</div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-outline" id="cancel-add-skill">
                                    Отмена
                                </button>
                                <button type="submit" class="btn btn-primary" id="submit-add-skill">
                                    <span id="add-skill-text">Добавить навык</span>
                                    <span id="add-skill-loading" class="d-none">
                                        <i class="fas fa-spinner fa-spin"></i> Сохранение...
                                    </span>
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Categories List -->
                    <div class="mt-3" id="categories-management-container">
                        <h3 class="card-title mb-3">Существующие категории и навыки</h3>
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="admin-skills-search" placeholder="Поиск навыка или категории...">
                        </div>
                        <!-- Categories will be loaded here -->
                    </div>
                </div>
            `;
            
            renderCategoriesForManagement();
            
            // Setup form event listeners
            setupCategoryForm();
            setupSkillForm();
            
            // Search functionality
            document.getElementById('admin-skills-search').addEventListener('input', filterAdminSkills);
        }

        function renderCategoriesForManagement() {
            const container = document.getElementById('categories-management-container');
            const existingContainer = container.querySelector('.category-with-skills');
            
            if (existingContainer) {
                existingContainer.remove();
            }
            
            const categoriesDiv = document.createElement('div');
            categoriesDiv.className = 'categories-list';
            
            if (categories.length === 0) {
                categoriesDiv.innerHTML = '<p class="text-center text-muted">Категории не найдены</p>';
                container.appendChild(categoriesDiv);
                return;
            }
            
            categories.forEach(category => {
                const categorySkills = skills.filter(skill => skill.categoryId === category.id);
                
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'category-with-skills';
                categoryDiv.innerHTML = `
                    <div class="category-title">
                        <span>
                            <i class="fas ${category.icon || 'fa-folder'}"></i> ${category.name}
                            <small class="text-muted">(${categorySkills.length} навыков)</small>
                        </span>
                        <div>
                            <button class="action-btn edit-btn edit-category-btn" data-id="${category.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete-btn delete-category-btn" data-id="${category.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="skills-in-category" id="skills-${category.id}"></div>
                `;
                
                categoriesDiv.appendChild(categoryDiv);
                
                // Render skills in this category
                const skillsContainer = document.getElementById(`skills-${category.id}`);
                if (categorySkills.length === 0) {
                    skillsContainer.innerHTML = '<p class="text-muted">Навыки не добавлены</p>';
                } else {
                    categorySkills.forEach(skill => {
                        const skillCard = document.createElement('div');
                        skillCard.className = 'skill-card';
                        skillCard.innerHTML = `
                            <h4>${skill.name} ${skill.isRequired ? '<span class="badge badge-warning">Обязательный</span>' : ''}</h4>
                            <p class="text-muted">${skill.description || 'Описание отсутствует'}</p>
                            <div class="skill-card-actions">
                                <button class="action-btn edit-btn edit-skill-btn" data-id="${skill.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete-btn delete-skill-btn" data-id="${skill.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        `;
                        skillsContainer.appendChild(skillCard);
                    });
                }
                
                // Add event listeners for category buttons
                categoryDiv.querySelector('.edit-category-btn').addEventListener('click', function() {
                    showEditCategoryForm(this.dataset.id);
                });
                
                categoryDiv.querySelector('.delete-category-btn').addEventListener('click', function() {
                    deleteCategory(this.dataset.id);
                });
            });
            
            container.appendChild(categoriesDiv);
            
            // Add event listeners for skill buttons
            setTimeout(() => {
                document.querySelectorAll('.edit-skill-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        showEditSkillForm(this.dataset.id);
                    });
                });
                
                document.querySelectorAll('.delete-skill-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        deleteSkill(this.dataset.id);
                    });
                });
            }, 100);
        }

        function setupCategoryForm() {
            const form = document.getElementById('add-category-form');
            const cancelBtn = document.getElementById('cancel-add-category');
            
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                await handleAddCategory();
            });
            
            cancelBtn.addEventListener('click', function() {
                form.reset();
                // Clear errors
                document.querySelectorAll('#add-category-form .form-error').forEach(el => {
                    el.textContent = '';
                    el.classList.remove('show');
                });
            });
        }

        async function handleAddCategory() {
            const form = document.getElementById('add-category-form');
            const nameInput = document.getElementById('category-name');
            const descriptionInput = document.getElementById('category-description');
            const iconSelect = document.getElementById('category-icon');
            
            const submitBtn = document.getElementById('submit-add-category');
            const submitText = document.getElementById('add-category-text');
            const submitLoading = document.getElementById('add-category-loading');
            
            // Validate
            let isValid = true;
            
            if (!validateField(nameInput, 'Название категории обязательно')) {
                isValid = false;
            }
            
            if (!isValid) {
                return;
            }
            
            // Show loading state
            submitText.classList.add('d-none');
            submitLoading.classList.remove('d-none');
            submitBtn.disabled = true;
            
            try {
                const categoryData = {
                    name: nameInput.value.trim(),
                    description: descriptionInput.value.trim(),
                    icon: iconSelect.value
                };
                
                const response = await apiRequest(API_ENDPOINTS.CATEGORIES, {
                    method: 'POST',
                    body: JSON.stringify(categoryData)
                });
                
                // Update local categories
                categories.push(response.category);
                
                // Reset form
                form.reset();
                
                // Refresh categories list
                renderCategoriesForManagement();
                
                showToast('Категория успешно добавлена!', 'success');
                
            } catch (error) {
                console.error('Failed to add category:', error);
                showToast(error.message || 'Ошибка добавления категории', 'danger');
                
            } finally {
                // Reset loading state
                submitText.classList.remove('d-none');
                submitLoading.classList.add('d-none');
                submitBtn.disabled = false;
            }
        }

        function showEditCategoryForm(categoryId) {
            const category = categories.find(c => c.id == categoryId);
            if (!category) return;
            
            // Remove any existing edit form
            const existingForm = document.querySelector('.edit-category-form');
            if (existingForm) {
                existingForm.remove();
            }
            
            // Create edit form
            const categoryElement = document.querySelector(`[data-id="${categoryId}"]`).closest('.category-with-skills');
            const editForm = document.createElement('div');
            editForm.className = 'edit-form edit-category-form';
            editForm.innerHTML = `
                <div class="edit-form-header">
                    <h4 class="edit-form-title">Редактирование категории</h4>
                    <button class="action-btn cancel-edit-category-btn">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="edit-category-form-${categoryId}">
                    <div class="form-group">
                        <label class="form-label">Название категории *</label>
                        <input type="text" class="form-control" value="${category.name}" 
                               id="edit-category-name-${categoryId}" required>
                        <div class="form-error" id="edit-category-name-error-${categoryId}"></div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Описание</label>
                        <textarea class="form-control" rows="3" 
                                  id="edit-category-description-${categoryId}">${category.description || ''}</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Иконка</label>
                        <select class="select-control" id="edit-category-icon-${categoryId}">
                            <option value="fa-code" ${category.icon === 'fa-code' ? 'selected' : ''}>Code (fa-code)</option>
                            <option value="fa-database" ${category.icon === 'fa-database' ? 'selected' : ''}>Database (fa-database)</option>
                            <option value="fa-tools" ${category.icon === 'fa-tools' ? 'selected' : ''}>Tools (fa-tools)</option>
                            <option value="fa-chart-line" ${category.icon === 'fa-chart-line' ? 'selected' : ''}>Chart (fa-chart-line)</option>
                            <option value="fa-comments" ${category.icon === 'fa-comments' ? 'selected' : ''}>Comments (fa-comments)</option>
                            <option value="fa-users" ${category.icon === 'fa-users' ? 'selected' : ''}>Users (fa-users)</option>
                            <option value="fa-cogs" ${category.icon === 'fa-cogs' ? 'selected' : ''}>Cogs (fa-cogs)</option>
                            <option value="fa-laptop-code" ${category.icon === 'fa-laptop-code' ? 'selected' : ''}>Laptop (fa-laptop-code)</option>
                        </select>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-outline cancel-edit-category-btn">
                            Отмена
                        </button>
                        <button type="submit" class="btn btn-primary">
                            Сохранить изменения
                        </button>
                    </div>
                </form>
            `;
            
            categoryElement.parentNode.insertBefore(editForm, categoryElement);
            
            // Add event listeners
            const form = document.getElementById(`edit-category-form-${categoryId}`);
            const cancelBtns = editForm.querySelectorAll('.cancel-edit-category-btn');
            
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                await handleEditCategory(categoryId);
            });
            
            cancelBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    editForm.remove();
                });
            });
        }

        async function handleEditCategory(categoryId) {
            const nameInput = document.getElementById(`edit-category-name-${categoryId}`);
            const descriptionInput = document.getElementById(`edit-category-description-${categoryId}`);
            const iconSelect = document.getElementById(`edit-category-icon-${categoryId}`);
            
            // Validate
            if (!validateField(nameInput, 'Название категории обязательно')) {
                return;
            }
            
            try {
                const categoryData = {
                    name: nameInput.value.trim(),
                    description: descriptionInput.value.trim(),
                    icon: iconSelect.value
                };
                
                const response = await apiRequest(API_ENDPOINTS.CATEGORY_BY_ID(categoryId), {
                    method: 'PUT',
                    body: JSON.stringify(categoryData)
                });
                
                // Update local category
                const index = categories.findIndex(c => c.id == categoryId);
                if (index >= 0) {
                    categories[index] = response.category;
                }
                
                // Remove edit form and refresh
                document.querySelector('.edit-category-form').remove();
                renderCategoriesForManagement();
                
                showToast('Категория успешно обновлена!', 'success');
                
            } catch (error) {
                console.error('Failed to edit category:', error);
                showToast(error.message || 'Ошибка обновления категории', 'danger');
            }
        }

        async function deleteCategory(categoryId) {
            const category = categories.find(c => c.id == categoryId);
            if (!category) return;
            
            const categorySkills = skills.filter(skill => skill.categoryId == categoryId);
            
            let message = `Вы уверены, что хотите удалить категорию "${category.name}"?`;
            
            if (categorySkills.length > 0) {
                message += `\n\nВ категории есть ${categorySkills.length} навыков. Они также будут удалены.`;
            }
            
            if (!confirm(message)) {
                return;
            }
            
            try {
                await apiRequest(API_ENDPOINTS.CATEGORY_BY_ID(categoryId), {
                    method: 'DELETE'
                });
                
                // Update local data
                categories = categories.filter(c => c.id != categoryId);
                skills = skills.filter(skill => skill.categoryId != categoryId);
                
                // Refresh display
                renderCategoriesForManagement();
                
                showToast('Категория успешно удалена!', 'success');
                
            } catch (error) {
                console.error('Failed to delete category:', error);
                showToast(error.message || 'Ошибка удаления категории', 'danger');
            }
        }

        function setupSkillForm() {
            const form = document.getElementById('add-skill-form');
            const cancelBtn = document.getElementById('cancel-add-skill');
            
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                await handleAddSkill();
            });
            
            cancelBtn.addEventListener('click', function() {
                form.reset();
                // Clear errors
                document.querySelectorAll('#add-skill-form .form-error').forEach(el => {
                    el.textContent = '';
                    el.classList.remove('show');
                });
            });
        }

        async function handleAddSkill() {
            const form = document.getElementById('add-skill-form');
            const nameInput = document.getElementById('skill-name');
            const descriptionInput = document.getElementById('skill-description');
            const categorySelect = document.getElementById('skill-category');
            const requiredCheckbox = document.getElementById('skill-required');
            
            const submitBtn = document.getElementById('submit-add-skill');
            const submitText = document.getElementById('add-skill-text');
            const submitLoading = document.getElementById('add-skill-loading');
            
            // Validate
            let isValid = true;
            
            if (!validateField(nameInput, 'Название навыка обязательно')) {
                isValid = false;
            }
            
            if (!validateField(categorySelect, 'Выберите категорию')) {
                isValid = false;
            }
            
            if (!isValid) {
                return;
            }
            
            // Show loading state
            submitText.classList.add('d-none');
            submitLoading.classList.remove('d-none');
            submitBtn.disabled = true;
            
            try {
                const skillData = {
                    name: nameInput.value.trim(),
                    description: descriptionInput.value.trim(),
                    categoryId: parseInt(categorySelect.value),
                    isRequired: requiredCheckbox.checked
                };
                
                const response = await apiRequest(API_ENDPOINTS.SKILLS, {
                    method: 'POST',
                    body: JSON.stringify(skillData)
                });
                
                // Update local skills
                skills.push(response.skill);
                
                // Reset form
                form.reset();
                
                // Refresh skills list
                renderCategoriesForManagement();
                
                showToast('Навык успешно добавлен!', 'success');
                
            } catch (error) {
                console.error('Failed to add skill:', error);
                showToast(error.message || 'Ошибка добавления навыка', 'danger');
                
            } finally {
                // Reset loading state
                submitText.classList.remove('d-none');
                submitLoading.classList.add('d-none');
                submitBtn.disabled = false;
            }
        }

        function showEditSkillForm(skillId) {
            const skill = skills.find(s => s.id == skillId);
            if (!skill) return;
            
            const category = categories.find(c => c.id == skill.categoryId);
            
            // Remove any existing edit form
            const existingForm = document.querySelector('.edit-skill-form');
            if (existingForm) {
                existingForm.remove();
            }
            
            // Create edit form
            const skillCard = document.querySelector(`[data-id="${skillId}"]`).closest('.skill-card');
            const editForm = document.createElement('div');
            editForm.className = 'edit-form edit-skill-form';
            editForm.innerHTML = `
                <div class="edit-form-header">
                    <h4 class="edit-form-title">Редактирование навыка</h4>
                    <button class="action-btn cancel-edit-skill-btn">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="edit-skill-form-${skillId}">
                    <div class="form-group">
                        <label class="form-label">Название навыка *</label>
                        <input type="text" class="form-control" value="${skill.name}" 
                               id="edit-skill-name-${skillId}" required>
                        <div class="form-error" id="edit-skill-name-error-${skillId}"></div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Описание</label>
                        <textarea class="form-control" rows="3" 
                                  id="edit-skill-description-${skillId}">${skill.description || ''}</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Категория *</label>
                        <select class="select-control" id="edit-skill-category-${skillId}" required>
                            <option value="">Выберите категорию</option>
                            ${categories.map(cat => 
                                `<option value="${cat.id}" ${cat.id === skill.categoryId ? 'selected' : ''}>${cat.name}</option>`
                            ).join('')}
                        </select>
                        <div class="form-error" id="edit-skill-category-error-${skillId}"></div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="edit-skill-required-${skillId}" ${skill.isRequired ? 'checked' : ''}> 
                            Обязательный навык
                        </label>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-outline cancel-edit-skill-btn">
                            Отмена
                        </button>
                        <button type="submit" class="btn btn-primary">
                            Сохранить изменения
                        </button>
                    </div>
                </form>
            `;
            
            skillCard.parentNode.insertBefore(editForm, skillCard);
            skillCard.style.display = 'none';
            
            // Add event listeners
            const form = document.getElementById(`edit-skill-form-${skillId}`);
            const cancelBtns = editForm.querySelectorAll('.cancel-edit-skill-btn');
            
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                await handleEditSkill(skillId);
            });
            
            cancelBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    editForm.remove();
                    skillCard.style.display = 'block';
                });
            });
        }

        async function handleEditSkill(skillId) {
            const nameInput = document.getElementById(`edit-skill-name-${skillId}`);
            const descriptionInput = document.getElementById(`edit-skill-description-${skillId}`);
            const categorySelect = document.getElementById(`edit-skill-category-${skillId}`);
            const requiredCheckbox = document.getElementById(`edit-skill-required-${skillId}`);
            
            // Validate
            let isValid = true;
            
            if (!validateField(nameInput, 'Название навыка обязательно')) {
                isValid = false;
            }
            
            if (!validateField(categorySelect, 'Выберите категорию')) {
                isValid = false;
            }
            
            if (!isValid) {
                return;
            }
            
            try {
                const skillData = {
                    name: nameInput.value.trim(),
                    description: descriptionInput.value.trim(),
                    categoryId: parseInt(categorySelect.value),
                    isRequired: requiredCheckbox.checked
                };
                
                const response = await apiRequest(API_ENDPOINTS.SKILL_BY_ID(skillId), {
                    method: 'PUT',
                    body: JSON.stringify(skillData)
                });
                
                // Update local skill
                const index = skills.findIndex(s => s.id == skillId);
                if (index >= 0) {
                    skills[index] = response.skill;
                }
                
                // Remove edit form and refresh
                document.querySelector('.edit-skill-form').remove();
                renderCategoriesForManagement();
                
                showToast('Навык успешно обновлен!', 'success');
                
            } catch (error) {
                console.error('Failed to edit skill:', error);
                showToast(error.message || 'Ошибка обновления навыка', 'danger');
            }
        }

        async function deleteSkill(skillId) {
            const skill = skills.find(s => s.id == skillId);
            if (!skill) return;
            
            if (!confirm(`Вы уверены, что хотите удалить навык "${skill.name}"?`)) {
                return;
            }
            
            try {
                await apiRequest(API_ENDPOINTS.SKILL_BY_ID(skillId), {
                    method: 'DELETE'
                });
                
                // Update local skills
                skills = skills.filter(s => s.id != skillId);
                
                // Refresh display
                renderCategoriesForManagement();
                
                showToast('Навык успешно удален!', 'success');
                
            } catch (error) {
                console.error('Failed to delete skill:', error);
                showToast(error.message || 'Ошибка удаления навыка', 'danger');
            }
        }

        function filterAdminSkills(e) {
            const searchTerm = e.target.value.toLowerCase();
            const categoryElements = document.querySelectorAll('.category-with-skills');
            
            categoryElements.forEach(category => {
                const categoryName = category.querySelector('.category-title span').textContent.toLowerCase();
                const skillCards = category.querySelectorAll('.skill-card');
                let categoryVisible = categoryName.includes(searchTerm);
                
                skillCards.forEach(skill => {
                    const skillName = skill.querySelector('h4').textContent.toLowerCase();
                    const skillDesc = skill.querySelector('p').textContent.toLowerCase();
                    
                    if (skillName.includes(searchTerm) || skillDesc.includes(searchTerm)) {
                        skill.style.display = 'block';
                        categoryVisible = true;
                    } else {
                        skill.style.display = 'none';
                    }
                });
                
                category.style.display = categoryVisible ? 'block' : 'none';
            });
        }

        // ===== TOAST NOTIFICATIONS =====
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toast-container');
            
            const toast = document.createElement('div');
            toast.className = `toast toast-${type} fade-in`;
            
            const icons = {
                success: 'fa-check-circle',
                warning: 'fa-exclamation-triangle',
                danger: 'fa-times-circle',
                info: 'fa-info-circle'
            };
            
            toast.innerHTML = `
                <div class="toast-icon">
                    <i class="fas ${icons[type] || icons.info}"></i>
                </div>
                <div class="toast-content">
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            toastContainer.appendChild(toast);
            
            // Auto remove after 5 seconds
            const autoRemove = setTimeout(() => {
                removeToast(toast);
            }, 5000);
            
            // Close button
            toast.querySelector('.toast-close').addEventListener('click', () => {
                clearTimeout(autoRemove);
                removeToast(toast);
            });
        }

        function removeToast(toast) {
            toast.style.animation = 'slideOutRight 0.3s ease';
            setTimeout(() => {
                toast.remove();
            }, 300);
        }

        // ===== NOTIFICATIONS =====
        function updateNotificationsCount() {
            const count = notifications.length;
            document.getElementById('notifications-count').textContent = count;
            
            // Update count in home page if exists
            const homeCount = document.getElementById('home-notifications-count');
            if (homeCount) {
                homeCount.textContent = count;
            }
        }

        async function loadNotificationsPage(container) {
            try {
                const notificationsData = await apiRequest(API_ENDPOINTS.NOTIFICATIONS);
                
                container.innerHTML = `
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Уведомления</h3>
                            ${notificationsData.length > 0 ? `
                                <button class="btn btn-outline" id="mark-all-read-btn">
                                    <i class="fas fa-check-double"></i> Отметить все как прочитанные
                                </button>
                            ` : ''}
                        </div>
                        
                        ${notificationsData.length > 0 ? `
                            <div class="notifications-list" id="notifications-list">
                                ${notificationsData.map(notification => `
                                    <div class="notification-item ${notification.read ? '' : 'unread'}" data-notification-id="${notification.id}">
                                        <div class="notification-header">
                                            <div class="notification-title">${notification.title}</div>
                                            <div class="notification-time">${formatDate(notification.createdAt)}</div>
                                        </div>
                                        <p>${notification.message}</p>
                                        ${notification.actions ? `
                                            <div class="notification-actions">
                                                ${notification.actions.map(action => `
                                                    <button class="btn btn-sm ${action.type === 'primary' ? 'btn-primary' : 'btn-outline'}"
                                                            data-action="${action.type}">
                                                        ${action.label}
                                                    </button>
                                                `).join('')}
                                            </div>
                                        ` : ''}
                                    </div>
                                `).join('')}
                            </div>
                        ` : `
                            <div class="text-center py-4">
                                <i class="fas fa-bell-slash fa-3x text-muted mb-3"></i>
                                <p class="text-muted">Нет уведомлений</p>
                            </div>
                        `}
                    </div>
                `;
                
                // Add event listeners
                if (notificationsData.length > 0) {
                    document.getElementById('mark-all-read-btn').addEventListener('click', markAllNotificationsRead);
                    
                    // Add click handlers for notification actions
                    document.querySelectorAll('.notification-actions button').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const notificationId = this.closest('.notification-item').dataset.notificationId;
                            const action = this.dataset.action;
                            handleNotificationAction(notificationId, action);
                        });
                    });
                }
                
            } catch (error) {
                console.error('Failed to load notifications:', error);
                container.innerHTML = `
                    <div class="card">
                        <h3>Ошибка загрузки уведомлений</h3>
                        <p class="mt-2">${error.message}</p>
                    </div>
                `;
            }
        }

        async function markAllNotificationsRead() {
            try {
                await apiRequest('/notifications/mark-all-read', {
                    method: 'POST'
                });
                
                // Update local notifications
                notifications = [];
                updateNotificationsCount();
                
                // Refresh notifications page
                loadNotificationsPage(document.getElementById('content-area'));
                
                showToast('Все уведомления отмечены как прочитанные', 'success');
                
            } catch (error) {
                console.error('Failed to mark notifications as read:', error);
                showToast('Ошибка обновления уведомлений', 'danger');
            }
        }

        async function handleNotificationAction(notificationId, action) {
            try {
                // Mark notification as read
                await apiRequest(`/notifications/${notificationId}/read`, {
                    method: 'POST'
                });
                
                // Handle specific actions
                switch(action) {
                    case 'view_skill':
                        navigateTo('skills');
                        break;
                    case 'view_profile':
                        navigateTo('profile');
                        break;
                    case 'confirm_rating':
                        // In a real app, this would confirm a rating
                        showToast('Оценка подтверждена', 'success');
                        break;
                }
                
                // Remove notification from list
                const notificationElement = document.querySelector(`[data-notification-id="${notificationId}"]`);
                if (notificationElement) {
                    notificationElement.remove();
                    
                    // Update notifications count
                    notifications = notifications.filter(n => n.id != notificationId);
                    updateNotificationsCount();
                }
                
            } catch (error) {
                console.error('Failed to handle notification action:', error);
                showToast('Ошибка обработки уведомления', 'danger');
            }
        }

        // ===== HELPER FUNCTIONS =====
        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / (1000 * 60));
            const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
            
            if (diffMins < 1) {
                return 'только что';
            } else if (diffMins < 60) {
                return `${diffMins} мин. назад`;
            } else if (diffHours < 24) {
                return `${diffHours} ч. назад`;
            } else if (diffDays < 7) {
                return `${diffDays} дн. назад`;
            } else {
                return date.toLocaleDateString('ru-RU', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric'
                });
            }
        }

        // Note: Other page functions (loadEmployeesPage, loadComparePage, loadUsersManagementPage, 
        // loadReportsPage, loadExportPage, loadRequiredSkillsPage, loadHistoryPage) would be implemented
        // similarly with API integration. Due to length constraints, I've shown the pattern with
        // the most important pages. The implementation would follow the same patterns:
        // 1. Load data from API
        // 2. Render HTML templates
        // 3. Add event listeners
        // 4. Handle form submissions
        // 5. Show toast notifications

        // Initialize the app
        console.log('SkillMatrix application initialized');
    </script>
</body>
</html>